---
description: 
globs: 
alwaysApply: true
---
# ğŸ¤– Build and Development Rules

This document defines the technical standards for building the Travel Insiders platform.

It does **not** define business logic (which is documented separately).

---

## ğŸš€ Overview
- UI: **Next.js** (App Directory, TypeScript, Tailwind, Shadcn, Supabase UI)
- Database: **Supabase (Postgres)** â€” all queries through Supabase SDK.
- Automation: **n8n.io** (called via Supabase functions when needed).

All CLI operations use `npx`.

---

# ğŸ› ï¸ Global NEVERS and ALWAYs

## NEVER:
- âŒ Write SQL migrations manually.  
  Use Supabase migrations and CLI tools only.
- âŒ Hardcode URLs, tokens, or environment-specific values.  
  Load them from `.env` files only at runtime.
- âŒ Use raw SQL connections inside Next.js apps.
- âŒ Use modals or slideouts for CRUD views.

## ALWAYS:
- âœ… Use `npx supabase` for database schema changes, migrations, functions.
- âœ… Use **Supabase UI** first, then **Shadcn** if missing.
- âœ… Use Supabase SDK (`@supabase/supabase-js`) for all database operations.
- âœ… Load all sensitive credentials via `.env` files.
- âœ… Use path-based routing for resources (no nested modals).

---

# ğŸ”¥ UI Conventions

- **Resource Routes:**
  - Create: `/resource/create`
  - View: `/resource/[uuid]`
  - Edit: `/resource/[uuid]/edit`

Example:
- `/tasks/create`
- `/tasks/7ff1bcbc-df0c-482b-89c8-391aac2521cf`
- `/tasks/7ff1bcbc-df0c-482b-89c8-391aac2521cf/edit`

- **Avatar**: Use Supabase Avatar component.  
- **File Upload**: Use Supabase DropZone component via Shadcn import.

---

# ğŸ—„ï¸ Database & Supabase

- **Migrations**: 
  - Always use `npx supabase db` commands.
  - Example: `npx supabase db diff --local`.
- **Local Dev**:
  - Use local Supabase URLs and ports.
  - Connect through the exposed firewall IP.

Example `.env` pattern:

```ts
const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL || "https://project.supabase.co";
const SUPABASE_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || "your-default-key";

	â€¢	Pull Schema:

npx supabase db pull --db-url=postgresql://...

	â€¢	Seed Data:

npx supabase db dump --data-only -f supabase/seed.sql
npx supabase db reset --local



â¸»

ğŸ“š CLI Rules
	â€¢	Migrations: npx supabase db diff
	â€¢	Push: npx supabase db push
	â€¢	Pull: npx supabase db pull
	â€¢	Reset Local: npx supabase db reset --local
	â€¢	Always pass the --local flag during development.

â¸»

ğŸš€ Deployment
	â€¢	Supabase deployment docs:
https://supabase.com/docs/guides/deployment
	â€¢	Follow .env driven defaults for production settings.

â¸»

ğŸ›‘ Reminders
	â€¢	Supabase is the source of truth.
	â€¢	No direct database writes from N8N unless triggered through a Supabase Function.
	â€¢	No API routes that bypass Supabase SDK (no direct fetch to database endpoints).

part of your company instantly.) ğŸ”¥



## Auth 

All auth is managed by Supabse ui components so no form witing is needed 
npx shadcn@latest add https://supabase.com/ui/r/supabase-client-nextjs.json
Usage
This block installs a Supabase client for connecting your Next.js project to Supabase. It's designed for use with the App Router and fully supports server-side rendering (SSR).

If you've already set up your Supabase clientâ€”either using the npx create-next-app -e with-supabase template or another methodâ€”you can continue using your existing setup.

Getting started
First, add a .env file to your project with the following environment variables:

NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=

Copy
If you're using supabase.com, you can find these values in the Connect modal under App Frameworks or in your project's API settings.

If you're using a local instance of Supabase, you can find these values by running supabase start or supabase status (if you already have it running).

This Supabase client is built for SSR with the Next.js App Router. If you're building a React SPA, use the React SPA client instead.

Further reading
Generating TypeScript types for your client

